!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).modelz=t()}(this,(function(){"use strict";function e(){}function t(e){return e}function r(e){return{}.toString.call(e)}function n(e){return"[object Array]"==r(e)}function o(e){return"function"==typeof e}function i(e){return"string"==typeof e}function u(e,t){return o(e)?e(t):e}const a={construct:t,getCacheKey:e,enumerable:!0,required:!1,format:t,parse:t},c={castString:!0,parseNumbers:!0,onChangeListener:()=>e,extraProperties:!1,embedPlainData:!0,preInit:t,postInit:t,types:{}};function s({cacheKey:t}){return n(t)?e=>t.map((t=>e[t]instanceof Date?e[t].getTime():e[t])).join("|<3|"):o(t)?t:e}return function(e){const{castString:f,debug:l,embedPlainData:p,extraProperties:d,onChangeListener:g,parseNumbers:y,postInit:b,preInit:m,types:h}={...c,...e};function P(e,r){const n={string(e){if(i(e))return e;if(f)return""+e;throw Error(`Expect a string for "${r}", got "${e}"`)},number(e){if("number"==typeof e)return e;if(i(e)&&y)return parseFloat(e);throw Error(`Expect a number for "${r}", got "${e}"`)},boolean:e=>!!e,array:e=>[...e],object:e=>({...e}),date:e=>new Date(e),identity:t,...h};if(o(e))return e;if(null==n[e])throw Error(`Try to use unknown type "${e}" as type for "${r}"`);return n[e]}function j(e,t){if(null!==(u=e)&&"[object Object]"===r(u)){if(o(e.construct))return e;if(i(e.type))return{construct:P(e.type,t),...e};if(o(e.get))return{getCacheKey:s(e),get:e.get,set:e.set,enumerable:e.enumerable||!1}}var u;if(n(e)&&2===e.length){const[r,n]=e;return{construct:P(r,t),required:n}}if(n(e)&&3===e.length){const[r,n,o]=e;return{construct:P(r,t),required:n,default:o}}if(o(e))return{construct:e};if(i(e))try{return{construct:P(e,t)}}catch(e){}try{return{construct:P(typeof e,t),required:!0,default:e}}catch(t){throw new Error(`No proper config handler found for config:\n${JSON.stringify(e)}`)}}return function(e,t){const r=(t={embedPlainData:p,extraProperties:d,preInit:m,postInit:b,onChangeListener:g,...t}).name?t.name:"instance",n={modelName:r};return function(o={}){if(l&&l.extend("create")(`constructing ${r} with data %O`,o),o._schema===n)return o;const i={};let c={};if(t.extraProperties)c={...o};else if(l){const t=Object.keys(e),n=Object.keys(o).filter((e=>!t.includes(e)));n.length&&l.extend("warn")(`The properties %o are not defined on target ${r} and will therefore be dropped.`,n)}t.embedPlainData&&Object.defineProperty(c,"_data",{get:()=>i,enumerable:!1}),Object.defineProperty(c,"_isInitialized",{get:()=>!0,enumerable:!1}),Object.defineProperty(c,"_schema",{get:()=>n,enumerable:!1}),c=t.preInit(c);const s=t.onChangeListener(c);for(const t in e){const r={...a,...j(e[t],t)},{format:n,parse:f}=r;if(Object.defineProperty(c,t,{enumerable:r.enumerable,get:function(){if(r.get){const e=r.getCacheKey(c);return i.hasOwnProperty(t)&&null!=e&&e===i[t].key||(i[t]={key:e,value:r.get(c)}),n(i[t].value)}return n(i[t],c,r)},set:function(e){e=f(e,c,r);const n=c[t];r.set?r.set(c,e):r.required||null!=e?i[t]=r.construct(e,c,r):i[t]=e=null,s(t,e,n)}}),null!=o[t])c[t]=o[t];else if(r.hasOwnProperty("default"))c[t]=u(r.default,o);else{if(r.required)throw Error("No value set for "+t);r.get||(c[t]=null)}}return c=t.postInit(c),d||Object.seal(c),c}}}}));
//# sourceMappingURL=modelz.js.map
