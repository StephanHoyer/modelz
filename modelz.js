!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).modelz=t()}(this,(function(){"use strict";function e(){}function t(e){return e}function n(e){return{}.toString.call(e)}function r(e){return"[object Array]"==n(e)}function o(e){return"function"==typeof e}function u(e){return"string"==typeof e}const i={construct:t,getCacheKey:e,enumerable:!0,required:!1},c={castString:!0,parseNumbers:!0,onChangeListener:function(){return e},extraProperties:!1,embedPlainData:!0,preInit:t,postInit:t,types:{}};function a(t){return r(t.cacheKey)?function(e){return t.cacheKey.map((t=>e[t])).join("|<3|")}:o(t.cacheKey)?t.cacheKey:e}return function(s){function f(e,n){const r=Object.assign({string(e){if(u(e))return e;if(s.castString)return""+e;throw Error(`Expect a string for "${n}", got "${e}"`)},number(e){if("number"==typeof e)return e;if(u(e)&&s.parseNumbers)return parseFloat(e);throw Error(`Expect a number for "${n}", got "${e}"`)},boolean:e=>!!e,array:e=>[].concat(e),object:e=>Object.assign({},e),date:e=>new Date(e),identity:t},s.types);if(o(e))return e;if(null==r[e])throw Error(`Try to use unknown type "${e}" as type for "${n}"`);return r[e]}function l(e,t){if(null!==(i=e)&&"[object Object]"===n(i)){if(o(e.construct))return e;if(u(e.type))return Object.assign({construct:f(e.type,t)},e);if(o(e.get))return{getCacheKey:a(e),get:e.get,set:e.set,enumerable:e.enumerable||!1}}var i;if(r(e)&&2===e.length){const[n,r]=e;return{construct:f(n,t),required:r}}if(r(e)&&3===e.length){const[n,r,o]=e;return{construct:f(n,t),required:r,default:o}}if(o(e))return{construct:e};if(u(e))try{return{construct:f(e,t)}}catch(e){}try{return{construct:f(typeof e,t),required:!0,default:e}}catch(t){throw new Error(`No proper config handler found for config:\n${JSON.stringify(e)}`)}}return s=Object.assign({},c,s),function(t,n){const r=(n=Object.assign({},s,n)).name?n.name:"instance",u={modelName:r};return function(c={}){if(s.debug&&s.debug.extend("create")(`constructing ${r} with data %O`,c),c._schema===u)return c;const a={};let f=e,d={};if(n.extraProperties)d=Object.assign({},c);else if(s.debug){const e=Object.keys(t),n=Object.keys(c).filter((t=>!e.includes(t)));n.length&&s.debug.extend("warn")(`The properties %o are not defined on target ${r} and will therefore be dropped.`,n)}n.embedPlainData&&Object.defineProperty(d,"_data",{get:()=>a,enumerable:!1}),Object.defineProperty(d,"_isInitialized",{get:()=>!0,enumerable:!1}),Object.defineProperty(d,"_schema",{get:()=>u,enumerable:!1}),d=n.preInit(d),f=n.onChangeListener(d);for(const e in t){const n=Object.assign({},i,l(t[e],e));if(Object.defineProperty(d,e,{enumerable:n.enumerable,get:function(){if(n.get){const t=n.getCacheKey(d);return a.hasOwnProperty(e)&&null!=t&&t===a[e].key||(a[e]={key:t,value:n.get(d)}),a[e].value}return d._data[e]},set:function(t){const r=d[e];o(n.set)?n.set(d,t):n.required||null!=t?a[e]=n.construct(t,d,n):a[e]=t=null,f(e,t,r)}}),null!=c[e])d[e]=c[e];else if(n.hasOwnProperty("default"))o(n.default)?d[e]=n.default(c):d[e]=n.default;else{if(n.required)throw Error("No value set for "+e);n.get||(d[e]=null)}}return d=n.postInit(d),s.extraProperties||Object.seal(d),d}}}}));
//# sourceMappingURL=modelz.js.map
